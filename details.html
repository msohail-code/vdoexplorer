<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transaction Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <link rel="icon" href="https://voodootoken.com/hovihev/uploads/2024/11/Voodoo-Token-Logo.png">
</head>
<body class="bg-light p-4">

<div class="container">
  <h4 class="mb-4">Transaction Details</h4>
  <div class="text-center mt-4">
    <a href="index.html" class="btn btn-primary">üè† Go to Home</a>
  </div>

  <div id="loadingSpinner" class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <table id="transactionDetailsTable" class="table table-bordered table-striped table-sm" style="display: none;">
    <tbody></tbody>
  </table>

</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
$(document).ready(async function() {


    function formatDate(timestamp) {
    var  date = new Date(timestamp);

    var hours = date.getHours();
    var  minutes = date.getMinutes();
    var  seconds = date.getSeconds();
    var  ampm = hours >= 12 ? 'PM' : 'AM';

    hours = hours % 12;
    hours = hours ? hours : 12; // 0 should be 12

    var  month = date.getMonth() + 1; // Months are 0-based
    var  day = date.getDate();
    var  year = date.getFullYear();

    return (
        (month < 10 ? '0' + month : month) + '/' +
        (day < 10 ? '0' + day : day) + '/' +
        year + ' ' +
        (hours < 10 ? '0' + hours : hours) + ':' +
        (minutes < 10 ? '0' + minutes : minutes) + ':' +
        (seconds < 10 ? '0' + seconds : seconds) + ' ' +
        ampm
    );
  }

  function formatCurrency(value) {
        // Convert value from string to number, divide by 1e18 (assuming it's in Wei), and format
        return (parseFloat(value) / 1e18).toLocaleString(undefined, {minimumFractionDigits: 6}) + ' VDO';
    }

  const urlParams = new URLSearchParams(window.location.search);
  const hash = urlParams.get('hash');

  if (!hash) {
    alert('Transaction hash not provided.');
    window.location.href = 'index.html';
    return;
  }

  try {
    const response = await fetch(`https://api.scan.pulsechain.com/api/v2/transactions/${hash}`, {
      headers: { 'Accept': 'application/json' }
    });
    const details = await response.json();

    const tableBody = $('#transactionDetailsTable tbody');
    tableBody.empty();

    const fieldsToSkip = [
      'max_fee_per_gas', 
      'priority_fee', 
      'base_fee_per_gasukbnm',
      'created_contract',
      'position',
      'nonce',
      'has_error_in_internal_txs',
      'actions',
      'decoded_input',
      'token_transfers_overflow',
      'raw_input',
      'value',
      'max_priority_fee_per_gas',
      'revert_reason',
      'confirmation_duration',
      'tx_tag',
      
    ];

    

    for (var [key, value] of Object.entries(details)) {
        if(key==="timestamp"){
           value =  formatDate(value);
        }

        
        if (fieldsToSkip.includes(key)) {
        continue;
        }

        if (  key.includes('fee') && typeof value !== 'object') {
            value = (parseFloat(value) / 1e18).toFixed(6) + ' VDO';
        // Then use formattedFee wherever you want to show
        }
        

      tableBody.append(`
        <tr>
            
          <th class="text-end text-secondary">${key.replace(/_/g, ' ').toUpperCase()}</th>
          <td>${typeof value === 'object' && value !== null 
            ? formatObject(value,key) 
            : value}
          </td>
        </tr>
      `);
    }

    $('#loadingSpinner').hide();
    $('#transactionDetailsTable').show();

  } catch (error) {
    $('#loadingSpinner').html('<div class="text-danger">Failed to load transaction details.</div>');
    console.error('Error fetching transaction details:', error);
  }
});

Object.defineProperty(String.prototype, 'capitalize', {
  value: function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
  },
  enumerable: false
});



// Function to format object (like { key: value, key2: value2 })
function formatObject(obj,key) {
   
  let formatted = '<div>';
  for (var [k, v] of Object.entries(obj)) {
    if(key.includes('fee') && k.capitalize()==="Value"){
        v = (parseFloat(v) / 1e18).toFixed(6) + ' VDO';
    }
    formatted += `<div><b>${k.capitalize()}:</b> ${v}</div>`;
    if(key == 'to' || key=="from"){
       
        break;
        
    }
  }
  formatted += '</div>';
  return formatted;
}
</script>

</body>
</html>
